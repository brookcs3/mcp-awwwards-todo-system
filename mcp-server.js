#!/usr/bin/env node

/**
 * MCP Awwwards-Evaluated Todo System
 * Professional MCP server for Claude Desktop
 * 
 * Applies systematic design principles:
 * - Swiss Grid System (MÃ¼ller-Brockmann)
 * - Typography Hierarchy (Ellen Lupton)
 * - Awwwards Evaluation Criteria
 * - Cross-chat persistence with contextual triggers
 */

const { PersistentTodoManager } = require('./AwwwardsTodoSystem.js');

class MCPAwwwardsTodoServer {
  constructor() {
    this.name = "MCP Awwwards Todo System";
    this.version = "1.0.0";
    this.description = "ğŸ† Professional todo management with Swiss Grid principles and Awwwards evaluation";
    this.todoManager = new PersistentTodoManager();
    
    // MCP server identification
    this.serverInfo = {
      name: this.name,
      version: this.version,
      vendor: "Claude AI System for MCP",
      capabilities: [
        "cross-chat-persistence",
        "awwwards-evaluation", 
        "contextual-triggers",
        "swiss-grid-design",
        "typography-hierarchy"
      ]
    };
  }

  // Add system branding to all todo displays
  brandedTodoDisplay(sessionId, todos, context = {}) {
    const result = this.todoManager.displayIfTriggered(sessionId, todos, context);
    
    if (result.shouldDisplay) {
      // Add MCP system header
      const header = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ† MCP AWWWARDS TODO SYSTEM v${this.version}          â•‘
â•‘  Professional design â€¢ Claude Desktop MCP        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`;
      
      result.output = header + result.output;
      
      // Add system footer
      const footer = `
â”Œâ”€ MCP System Info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server: ${this.name.padEnd(34)} â”‚
â”‚ Design: Swiss Grid + Typography Hierarchy        â”‚  
â”‚ Standards: Awwwards Professional Evaluation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`;
      
      result.output += footer;
    }
    
    return result;
  }

  // Enhanced todo creation with MCP branding
  createBrandedTodo(sessionId, todos, style = 'minimalist', showScorecard = true) {
    const result = this.todoManager.createEvaluatedTodo(sessionId, todos, style, showScorecard);
    
    // Add MCP system identification header
    const mcpHeader = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ† MCP AWWWARDS TODO SYSTEM v${this.version}          â•‘  
â•‘  Professional MCP Server for Claude Desktop      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ Session: ${sessionId}
ğŸ¨ Style: ${style.toUpperCase()}
ğŸ“Š Evaluation: Live Awwwards Scoring

`;

    result.display = mcpHeader + result.display;
    
    // Add achievement badge
    const achievementBadge = `
â•­â”€ Achievement Level â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ ğŸ† ${result.awwwardsLevel.padEnd(42)} â”‚
â”‚ Score: ${result.evaluation.overall.toFixed(1)}/10 - Meeting professional standards â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

â”Œâ”€ MCP Server Features â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Swiss Grid mathematical precision              â”‚
â”‚ âœ… Typography hierarchy (Lupton principles)       â”‚
â”‚ âœ… Awwwards evaluation (40/30/20/10 weighting)    â”‚
â”‚ âœ… Cross-chat persistence                         â”‚
â”‚ âœ… Contextual auto-display triggers               â”‚
â”‚ âœ… Professional achievement levels                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ¤– Generated by MCP Awwwards Todo System for Claude Desktop`;

    result.display += achievementBadge;
    
    return result;
  }

  // Initialize new chat with MCP branding
  initializeWithBranding() {
    const initResult = this.todoManager.initializeNewChat();
    
    if (initResult && initResult.hasIncompleteTodos) {
      // Replace the basic display with branded version
      const todos = initResult.currentSession.todos;
      const brandedResult = this.createBrandedTodo(
        initResult.currentSession.id, 
        todos, 
        'minimalist', 
        true
      );
      
      initResult.initMessage = `ğŸ”„ **MCP AWWWARDS TODO SYSTEM - CONTINUING FROM PREVIOUS CHAT**

Most recent active session: **${initResult.currentSession.title || initResult.currentSession.id}**

${brandedResult.display}`;

      if (initResult.otherSessions && initResult.otherSessions.length > 0) {
        initResult.initMessage += `\n\nğŸ“‹ **OTHER ACTIVE SESSIONS (${initResult.otherSessions.length}):**\n`;
        const overviews = this.todoManager.generateSessionOverview({
          [initResult.currentSession.id]: initResult.currentSession, 
          ...Object.fromEntries(initResult.otherSessions.map(s => [s.id, s]))
        });
        
        overviews.slice(1).forEach(overview => {
          initResult.initMessage += `â€¢ ${overview.title} - ${overview.progress} (${overview.lastWorked})\n`;
        });
        
        initResult.initMessage += `\nâ“ Would you like to switch to a different session, or continue with "${initResult.currentSession.title || initResult.currentSession.id}"?`;
      }
    } else if (initResult) {
      initResult.message = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸ† MCP AWWWARDS TODO SYSTEM v${this.version}          â•‘
â•‘  Professional MCP Server for Claude Desktop      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ No active todos found. Ready to create a new session!

ğŸš€ MCP Server Features:
âœ… Swiss Grid mathematical precision
âœ… Typography hierarchy (Lupton principles)  
âœ… Awwwards evaluation (40/30/20/10 weighting)
âœ… Cross-chat persistence
âœ… Contextual auto-display triggers
âœ… Professional achievement levels

Ready to create professional-grade todos with award-winning design!`;
    }
    
    return initResult;
  }

  // Get server information for MCP protocol
  getServerInfo() {
    return this.serverInfo;
  }
}

// Export for MCP usage
module.exports = { MCPAwwwardsTodoServer };

// CLI usage for testing
if (require.main === module) {
  console.log('ğŸ† MCP Awwwards Todo System - Server Starting...\n');
  
  const server = new MCPAwwwardsTodoServer();
  console.log('Server Info:', server.getServerInfo());
  
  // Demo the branded system
  const sampleTodos = [
    { content: "Review MCP server documentation", status: "completed", priority: "high" },
    { content: "Test Swiss Grid implementation", status: "in_progress", priority: "medium" },
    { content: "Apply Awwwards evaluation criteria", status: "pending", priority: "high" }
  ];
  
  console.log('\nğŸ¯ DEMO: MCP Branded Todo Display\n');
  const result = server.createBrandedTodo("mcp-demo-session", sampleTodos, "minimalist", true);
  console.log(result.display);
}
